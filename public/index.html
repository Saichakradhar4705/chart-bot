<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IARE Campus Assistant â€“ Institute of Aeronautical Engineering</title>
  <meta name="description"
    content="Official AI-powered campus assistant for IARE Hyderabad. Get instant answers about admissions, programs, placements, facilities and more." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-deep: #030d1f;
      --bg-mid: #061529;
      --bg-light: #0b2145;
      --primary: #003087;
      --primary-light: #1B5DBF;
      --primary-glow: rgba(0, 48, 135, 0.45);
      --accent: #B8001C;
      --accent-light: #e8001f;
      --gold: #FDB813;
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #eef2ff;
      --text-secondary: #8fa3c8;
      --bubble-user: linear-gradient(135deg, #003087, #1B5DBF);
      --bubble-bot: rgba(255, 255, 255, 0.06);
      --input-bg: rgba(255, 255, 255, 0.06);
      --scrollbar: rgba(27, 93, 191, 0.5);
    }

    html,
    body {
      height: 100%;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(160deg, var(--bg-deep) 0%, var(--bg-mid) 50%, var(--bg-light) 100%);
      color: var(--text-primary);
      overflow: hidden;
    }

    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 860px;
      margin: 0 auto;
      padding: 0 18px;
    }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 0 14px;
      border-bottom: 1px solid var(--glass-border);
      flex-shrink: 0;
    }

    .logo {
      width: 46px;
      height: 46px;
      border-radius: 13px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      animation: logo-pulse 3.5s ease-in-out infinite;
      flex-shrink: 0;
    }

    @keyframes logo-pulse {

      0%,
      100% {
        box-shadow: 0 0 18px var(--primary-glow)
      }

      50% {
        box-shadow: 0 0 36px rgba(26, 58, 138, .65)
      }
    }

    .header-text {
      flex: 1
    }

    .header-text h1 {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: -.3px;
    }

    .header-text .sub {
      font-size: .74rem;
      color: var(--text-secondary);
      margin-top: 2px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
      display: inline-block;
      animation: blink 2.2s ease-in-out infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .35
      }
    }

    .mode-badge {
      font-size: .68rem;
      padding: 2px 8px;
      border-radius: 6px;
      font-weight: 600;
      letter-spacing: .3px;
    }

    .mode-badge.local {
      background: rgba(240, 165, 0, .15);
      border: 1px solid rgba(240, 165, 0, .35);
      color: var(--gold);
    }

    .mode-badge.gemini {
      background: rgba(77, 116, 232, .15);
      border: 1px solid rgba(77, 116, 232, .35);
      color: var(--primary-light);
    }

    .header-link {
      font-size: .73rem;
      color: var(--primary-light);
      text-decoration: none;
      border: 1px solid rgba(77, 116, 232, .3);
      border-radius: 8px;
      padding: 5px 11px;
      transition: all .2s;
      white-space: nowrap;
    }

    .header-link:hover {
      background: rgba(77, 116, 232, .15);
      border-color: var(--primary-light);
    }

    /* â”€â”€ CHAT WINDOW â”€â”€ */
    #chat-window {
      flex: 1;
      overflow-y: auto;
      padding: 18px 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
    }

    #chat-window::-webkit-scrollbar {
      width: 4px;
    }

    #chat-window::-webkit-scrollbar-thumb {
      background: var(--scrollbar);
      border-radius: 10px;
    }

    /* â”€â”€ MESSAGES â”€â”€ */
    .message {
      display: flex;
      gap: 10px;
      animation: fadeUp .3s ease;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(10px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .avatar {
      width: 33px;
      height: 33px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
      align-self: flex-end;
    }

    .avatar.bot {
      background: linear-gradient(135deg, var(--primary), var(--accent));
    }

    .avatar.user {
      background: rgba(255, 255, 255, .1);
      border: 1px solid var(--glass-border);
    }

    .msg-wrap {
      display: flex;
      flex-direction: column;
      max-width: 78%;
    }

    .message.user .msg-wrap {
      align-items: flex-end;
    }

    .bubble {
      padding: 11px 15px;
      border-radius: 18px;
      font-size: .89rem;
      line-height: 1.65;
      word-break: break-word;
      white-space: pre-wrap;
    }

    .message.bot .bubble {
      background: var(--bubble-bot);
      border: 1px solid var(--glass-border);
      border-bottom-left-radius: 4px;
      backdrop-filter: blur(10px);
    }

    .message.user .bubble {
      background: var(--bubble-user);
      border-bottom-right-radius: 4px;
      box-shadow: 0 4px 18px var(--primary-glow);
    }

    .message-time {
      font-size: .67rem;
      color: var(--text-secondary);
      margin-top: 4px;
      padding: 0 2px;
    }

    .local-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: .68rem;
      color: var(--gold);
      background: rgba(240, 165, 0, .12);
      border: 1px solid rgba(240, 165, 0, .3);
      border-radius: 6px;
      padding: 2px 8px;
      margin-top: 5px;
    }

    /* â”€â”€ TYPING â”€â”€ */
    .typing-indicator {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .typing-bubble {
      background: var(--bubble-bot);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      border-bottom-left-radius: 4px;
      padding: 13px 17px;
      display: flex;
      gap: 5px;
      align-items: center;
      backdrop-filter: blur(10px);
    }

    .typing-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--primary-light);
      animation: bounce 1.2s ease-in-out infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: .2s
    }

    .typing-dot:nth-child(3) {
      animation-delay: .4s
    }

    @keyframes bounce {

      0%,
      60%,
      100% {
        transform: translateY(0);
        opacity: .5
      }

      30% {
        transform: translateY(-6px);
        opacity: 1
      }
    }

    /* â”€â”€ CHAT INPUT (Gemini mode) â”€â”€ */
    .input-area {
      padding: 12px 0 18px;
      border-top: 1px solid var(--glass-border);
      flex-shrink: 0;
    }

    .input-wrapper {
      display: flex;
      gap: 10px;
      background: var(--input-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 10px 10px 10px 18px;
      backdrop-filter: blur(12px);
      transition: border-color .2s, box-shadow .2s;
    }

    .input-wrapper:focus-within {
      border-color: rgba(77, 116, 232, .6);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }

    #user-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: .9rem;
      font-family: 'Inter', sans-serif;
      resize: none;
      max-height: 120px;
      line-height: 1.5;
    }

    #user-input::placeholder {
      color: var(--text-secondary);
    }

    #send-btn {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all .2s;
      box-shadow: 0 4px 14px var(--primary-glow);
    }

    #send-btn:hover:not(:disabled) {
      transform: scale(1.08);
      box-shadow: 0 6px 20px rgba(26, 58, 138, .5)
    }

    #send-btn:disabled {
      opacity: .45;
      cursor: not-allowed;
      transform: none
    }

    #send-btn svg {
      width: 18px;
      height: 18px;
      fill: white
    }

    .input-hint {
      font-size: .7rem;
      color: var(--text-secondary);
      margin-top: 8px;
      text-align: center
    }

    .input-hint kbd {
      background: rgba(255, 255, 255, .1);
      border: 1px solid rgba(255, 255, 255, .15);
      border-radius: 4px;
      padding: 1px 5px;
      font-size: .68rem;
    }

    /* â”€â”€ FAQ MENU (Local mode) â”€â”€ */
    .faq-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-bottom: 4px;
    }

    .faq-header {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 22px 24px 18px;
      backdrop-filter: blur(14px);
      animation: fadeUp .5s ease;
    }

    .faq-header-top {
      display: flex;
      align-items: center;
      gap: 13px;
      margin-bottom: 12px;
    }

    .faq-icon {
      width: 50px;
      height: 50px;
      border-radius: 15px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .faq-header-top h2 {
      font-size: 1.18rem;
      font-weight: 700;
    }

    .faq-header-top p {
      font-size: .78rem;
      color: var(--gold);
      margin-top: 2px;
      font-weight: 500;
    }

    .faq-desc {
      font-size: .85rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .category-label {
      font-size: .7rem;
      color: var(--text-secondary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .8px;
      padding: 4px 2px 0;
    }

    .topic-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    @media(max-width: 520px) {
      .topic-grid {
        grid-template-columns: 1fr;
      }
    }

    .topic-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      padding: 14px 16px;
      cursor: pointer;
      transition: all .2s ease;
      text-align: left;
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
      font-size: .86rem;
      font-weight: 500;
      line-height: 1.3;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .topic-card:hover {
      background: rgba(26, 58, 138, .2);
      border-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(26, 58, 138, .2);
    }

    .topic-card .t-icon {
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .topic-card .t-label {
      flex: 1;
    }

    /* â”€â”€ ANSWER VIEW â”€â”€ */
    .answer-view {
      animation: fadeUp .3s ease;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      padding: 8px 14px;
      font-size: .8rem;
      color: var(--primary-light);
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all .2s;
      margin-bottom: 12px;
    }

    .back-btn:hover {
      background: rgba(77, 116, 232, .15);
      border-color: var(--primary-light);
    }

    .answer-bubble {
      background: var(--bubble-bot);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      border-top-left-radius: 4px;
      padding: 16px 18px;
      font-size: .89rem;
      line-height: 1.7;
      word-break: break-word;
      white-space: pre-wrap;
      backdrop-filter: blur(10px);
    }

    .answer-bubble a {
      color: var(--primary-light);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    /* â”€â”€ BOTTOM BAR (Local mode) â”€â”€ */
    .faq-footer {
      padding: 12px 0 18px;
      border-top: 1px solid var(--glass-border);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .faq-footer-hint {
      font-size: .76rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .contact-btn {
      flex-shrink: 0;
      font-size: .78rem;
      padding: 8px 16px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      text-decoration: none;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      transition: all .2s;
      box-shadow: 0 4px 14px var(--primary-glow);
    }

    .contact-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(26, 58, 138, .5);
    }

    /* â”€â”€ CATEGORY SECTIONS â”€â”€ */
    .cat-section {
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="logo">âœˆï¸</div>
      <div class="header-text">
        <h1>IARE Campus Assistant</h1>
        <div class="sub">
          <span class="status-dot"></span>
          <span id="mode-label">Loading...</span>
          <span class="mode-badge" id="mode-badge"></span>
        </div>
      </div>
      <a href="https://www.iare.ac.in/" target="_blank" rel="noopener" class="header-link">ğŸ”— iare.ac.in</a>
    </header>

    <!-- Chat window (used in both modes) -->
    <div id="chat-window"></div>

    <!-- Bottom bar: swapped dynamically based on mode -->
    <div id="bottom-bar"></div>
  </div>

  <script>
    // â”€â”€ CATEGORIES for FAQ grouping â”€â”€
    const CATEGORIES = [
      { label: 'ğŸ“ Admissions & Programs', ids: [10, 0, 11, 8, 9] },
      { label: 'ğŸ« Departments', ids: [1, 2, 3, 4, 5, 6, 7] },
      { label: 'ğŸ’¼ Career & Opportunities', ids: [11, 12, 14] },
      { label: 'ğŸ›ï¸ Campus Life', ids: [13, 10, 15, 19, 20] },
      { label: 'ğŸ”¬ Research & Innovation', ids: [16] },
      { label: 'ğŸ“‹ Academic Support', ids: [18, 13] },
      { label: 'ğŸ“ Help & Contact', ids: [17, 21, 22] },
    ];

    const chatWindow = document.getElementById('chat-window');
    const bottomBar = document.getElementById('bottom-bar');
    let appMode = 'gemini'; // 'gemini' | 'local'
    let allTopics = [];       // [{ id, topic }]
    let history = [];
    let waiting = false;

    const ICON_MAP = {
      'About IARE': 'ğŸ›ï¸',
      'Computer Science and Engineering': 'ğŸ’»',
      'Aeronautical Engineering': 'âœˆï¸',
      'Electronics and Communication Engineering': 'ğŸ“¡',
      'Electrical and Electronics Engineering': 'âš¡',
      'Mechanical Engineering': 'âš™ï¸',
      'Civil Engineering': 'ğŸ—ï¸',
      'MBA Program': 'ğŸ“Š',
      'M.Tech Programs': 'ğŸ“',
      'Ph.D Program': 'ğŸ”¬',
      'Admissions': 'ğŸ“',
      'Placements': 'ğŸ’¼',
      'Internships': 'ğŸ­',
      'Library': 'ğŸ“š',
      'Campus Facilities': 'ğŸ«',
      'Bus and Transport': 'ğŸšŒ',
      'Research and Innovation': 'ğŸ’¡',
      'Contact IARE': 'ğŸ“',
      'Rankings and Accreditation': 'ğŸ†',
      'Fees and Scholarships': 'ğŸ’°',
      "Exams, Results and Student Portals": 'ğŸ“…',
      "Student Life and Clubs": 'ğŸ‰',
      "Online Portals and e-Learning": 'ğŸ–¥ï¸',
      "Women's Helpline and Safety": 'ğŸ†˜',
      "Alumni": 'ğŸ“',
      "Faculty and Careers at IARE": 'ğŸ‘©â€ğŸ«',
    };

    function now() {
      return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function init() {
      try {
        const res = await fetch('/config');
        const data = await res.json();
        appMode = data.mode;
        allTopics = data.topics || [];

        const modeBadge = document.getElementById('mode-badge');
        const modeLabel = document.getElementById('mode-label');

        if (appMode === 'local') {
          modeLabel.textContent = 'FAQ Mode Â· IARE';
          modeBadge.textContent = 'ğŸ“š Local KB';
          modeBadge.className = 'mode-badge local';
          renderFAQMode();
        } else {
          modeLabel.textContent = 'Online Â· IARE, Hyderabad';
          modeBadge.textContent = 'ğŸ¤– AI Mode';
          modeBadge.className = 'mode-badge gemini';
          renderChatMode();
        }
      } catch (e) {
        console.error('Config load failed', e);
      }
    }

    // â”€â”€ FAQ MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderFAQMode() {
      chatWindow.innerHTML = '';
      renderTopicMenu();
      renderFAQFooter();
    }

    function renderTopicMenu() {
      const container = document.createElement('div');
      container.className = 'faq-container';
      container.id = 'faq-menu';

      // Header card
      container.innerHTML = `
        <div class="faq-header">
          <div class="faq-header-top">
            <div class="faq-icon">âœˆï¸</div>
            <div>
              <h2>IARE Campus FAQ</h2>
              <p>â­ NAAC A++ Â· JNTUH Affiliated Â· AICTE Approved</p>
            </div>
          </div>
          <p class="faq-desc">Select a topic below to get instant, accurate information about the Institute of Aeronautical Engineering, Hyderabad.</p>
        </div>`;

      // Render categories
      CATEGORIES.forEach(cat => {
        // filter to only ids that exist in allTopics
        const validIds = cat.ids.filter(id => allTopics[id]);
        if (!validIds.length) return;

        const section = document.createElement('div');
        section.className = 'cat-section';
        section.innerHTML = `<div class="category-label">${cat.label}</div>`;

        const grid = document.createElement('div');
        grid.className = 'topic-grid';

        validIds.forEach(id => {
          const t = allTopics[id];
          const icon = ICON_MAP[t.topic] || 'ğŸ“„';
          const btn = document.createElement('button');
          btn.className = 'topic-card';
          btn.dataset.id = id;
          btn.innerHTML = `<span class="t-icon">${icon}</span><span class="t-label">${t.topic}</span>`;
          btn.addEventListener('click', () => loadTopic(id, t.topic));
          grid.appendChild(btn);
        });

        section.appendChild(grid);
        container.appendChild(section);
      });

      chatWindow.appendChild(container);
    }

    async function loadTopic(id, topicName) {
      // Remove menu, show answer view
      const menu = document.getElementById('faq-menu');
      if (menu) menu.remove();

      // Show loading
      const loadEl = document.createElement('div');
      loadEl.className = 'typing-indicator';
      loadEl.innerHTML = `<div class="avatar bot">âœˆï¸</div><div class="typing-bubble"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
      chatWindow.appendChild(loadEl);

      try {
        const res = await fetch(`/topic/${id}`);
        const data = await res.json();
        loadEl.remove();
        renderAnswerView(data.topic, data.answer);
      } catch (e) {
        loadEl.remove();
        renderAnswerView(topicName, 'âš ï¸ Could not load this topic. Please check your connection or visit https://www.iare.ac.in/');
      }
    }

    function renderAnswerView(topic, answer) {
      const view = document.createElement('div');
      view.className = 'answer-view';

      // Back button
      const backBtn = document.createElement('button');
      backBtn.className = 'back-btn';
      backBtn.innerHTML = 'â† Back to Topics';
      backBtn.addEventListener('click', () => {
        view.remove();
        renderTopicMenu();
      });

      // Answer bubble with clickable links
      const bubble = document.createElement('div');
      bubble.className = 'answer-bubble';
      bubble.innerHTML = formatAnswer(answer);

      view.appendChild(backBtn);
      view.appendChild(bubble);
      chatWindow.appendChild(view);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function renderFAQFooter() {
      bottomBar.innerHTML = `
        <div class="faq-footer">
          <p class="faq-footer-hint">ğŸ“š <strong>FAQ Mode</strong> â€” Accurate answers from IARE's knowledge base.<br>
          For live queries, contact IARE directly.</p>
          <a href="tel:+919154379624" class="contact-btn">ğŸ“ Call Admissions</a>
        </div>`;
    }

    // â”€â”€ CHAT MODE (Gemini) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderChatMode() {
      // Welcome card
      chatWindow.innerHTML = `
        <div style="background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:22px;padding:26px 24px 20px;backdrop-filter:blur(14px);animation:fadeUp .5s ease">
          <div style="display:flex;align-items:center;gap:13px;margin-bottom:13px">
            <div style="width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">âœˆï¸</div>
            <div><h2 style="font-size:1.18rem;font-weight:700">IARE Campus Assistant</h2><p style="font-size:.78rem;color:var(--gold);margin-top:2px;font-weight:500">â­ NAAC A++ Rated Â· JNTUH Affiliated Â· AICTE Approved</p></div>
          </div>
          <p style="font-size:.86rem;color:var(--text-secondary);line-height:1.65;margin-bottom:16px">Ask me anything about IARE â€” admissions, programs, placements, campus life, research, and more!</p>
          <div style="background:rgba(192,57,43,.1);border:1px solid rgba(192,57,43,.25);border-radius:10px;padding:9px 13px;font-size:.77rem;color:#e88a7a;margin-bottom:18px;display:flex;gap:8px">
            <span>âš ï¸</span><span>I'm dedicated exclusively to IARE-related queries. Visit <a href="https://www.iare.ac.in/" target="_blank" style="color:#e88a7a">iare.ac.in</a> for all official info.</span>
          </div>
          <div style="font-size:.72rem;color:var(--text-secondary);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">Quick questions</div>
          <div style="display:flex;flex-wrap:wrap;gap:7px" id="chip-container">
            ${['âœˆï¸ Aeronautical Engineering', 'ğŸ“ Admission process', 'ğŸ’¼ Placement record', 'ğŸ« Campus facilities', 'ğŸ”¬ Research opportunities', 'ğŸ“ Contact IARE', 'ğŸ“ M.Tech & MBA', 'ğŸšŒ Bus facility'].map(
        t => `<button onclick="sendSuggestion(this)" style="background:rgba(26,58,138,.18);border:1px solid rgba(77,116,232,.3);border-radius:100px;padding:6px 13px;font-size:.78rem;cursor:pointer;color:var(--primary-light);transition:all .2s;font-family:'Inter',sans-serif;">${t}</button>`
      ).join('')}
          </div>
        </div>`;

      // Chat input
      bottomBar.innerHTML = `
        <div class="input-area">
          <div class="input-wrapper">
            <textarea id="user-input" rows="1" placeholder="Ask about IARE admissions, courses, placements..." aria-label="Chat message input"></textarea>
            <button id="send-btn" aria-label="Send message" onclick="sendMessage()">
              <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
          </div>
          <p class="input-hint">Press <kbd>Enter</kbd> to send &nbsp;Â·&nbsp; <kbd>Shift+Enter</kbd> for new line</p>
        </div>`;

      const userInput = document.getElementById('user-input');
      userInput.addEventListener('input', () => {
        userInput.style.height = 'auto';
        userInput.style.height = Math.min(userInput.scrollHeight, 120) + 'px';
      });
      userInput.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!waiting) sendMessage(); }
      });
    }

    // â”€â”€ CHAT HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addMessage(role, text, source) {
      const isUser = role === 'user';
      const isLocal = !isUser && source === 'local';
      const div = document.createElement('div');
      div.className = `message ${role}`;
      const badge = isLocal ? `<span class="local-badge">ğŸ“š Local KB</span>` : '';
      div.innerHTML = `
        <div class="avatar ${role}">${isUser ? 'ğŸ‘¤' : 'âœˆï¸'}</div>
        <div class="msg-wrap">
          <div class="bubble">${isUser ? esc(text) : formatAnswer(text)}</div>
          ${badge}
          <div class="message-time">${isUser ? '' : 'IARE Assistant Â· '}${now()}</div>
        </div>`;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      // Remove welcome card after first message
      const welcome = chatWindow.querySelector('[data-welcome]');
      if (welcome) welcome.remove();
    }

    function showTyping() {
      const el = document.createElement('div');
      el.className = 'typing-indicator'; el.id = 'typing';
      el.innerHTML = `<div class="avatar bot">âœˆï¸</div><div class="typing-bubble"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
      chatWindow.appendChild(el);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
    function hideTyping() { document.getElementById('typing')?.remove(); }
    function esc(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

    // Convert markdown-ish text + plain URLs to clickable links
    function formatAnswer(text) {
      const escaped = esc(text);
      // Make **bold**
      let html = escaped.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      // Make *italic*
      html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
      // Make clickable URLs â€” first handle markdown [text](url), then bare URLs
      html = html.replace(/\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener" style="color:var(--primary-light);text-underline-offset:3px;text-decoration:underline">$1</a>');
      html = html.replace(/(?<!href=")(https?:\/\/[^\s<>"\]]+)/g, '<a href="$1" target="_blank" rel="noopener" style="color:var(--primary-light);text-underline-offset:3px;text-decoration:underline">$1</a>');
      return html;
    }

    async function sendMessage(text) {
      const userInput = document.getElementById('user-input');
      const sendBtn = document.getElementById('send-btn');
      const msg = (text ?? userInput?.value ?? '').trim();
      if (!msg || waiting) return;

      waiting = true;
      if (sendBtn) sendBtn.disabled = true;
      if (!text && userInput) { userInput.value = ''; userInput.style.height = 'auto'; }

      addMessage('user', msg);
      showTyping();

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: msg, history })
        });
        const data = await res.json();
        hideTyping();
        const reply = data.reply || data.error || 'Sorry, I could not get a response.';
        addMessage('bot', reply, data.source);
        history.push({ role: 'user', content: msg });
        history.push({ role: 'assistant', content: reply });
        if (history.length > 20) history = history.slice(-20);
      } catch {
        hideTyping();
        addMessage('bot', 'âš ï¸ Unable to reach the server. Please check if the backend is running on port 5000, or contact IARE at info@iare.ac.in.');
      }

      waiting = false;
      if (sendBtn) sendBtn.disabled = false;
      if (userInput) userInput.focus();
    }

    function sendSuggestion(btn) {
      sendMessage(btn.textContent.replace(/^[\u{1F300}-\u{1FFFF}\u{2600}-\u{26FF}âœˆï¸ğŸ”¬ğŸ“ğŸ“ğŸ’¼ğŸ«ğŸ“ğŸšŒâ­]\s*/u, '').trim());
    }

    init();
  </script>
</body>

</html>